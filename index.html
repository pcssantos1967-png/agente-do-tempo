<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MeteoGov Brasil ¬∑ Intelig√™ncia Clim√°tica</title>
  <meta name="description" content="Informa√ß√µes meteorol√≥gicas em tempo real para todos os estados brasileiros. Temperatura, umidade, vento e previs√£o de 5 dias.">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Syne:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ========================================================================
       RESET E VARI√ÅVEIS BASE
       ======================================================================== */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      /* Tema Chuva (padr√£o) */
      --bg-primary: #060d1a;
      --bg-secondary: #0a1628;
      --accent: #4fc3f7;
      --accent2: #0288d1;
      --text: #e0f7fa;
      --text-muted: #90caf9;
      --card-bg: rgba(13, 32, 64, 0.88);
      --card-border: rgba(79, 195, 247, 0.25);
      --glow: rgba(79, 195, 247, 0.5);
      --shine: rgba(79, 195, 247, 0.15);

      /* Transi√ß√µes */
      --t: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

      /* Tipografia */
      --font-display: 'Bebas Neue', sans-serif;
      --font-mono: 'DM Mono', monospace;
      --font-body: 'Syne', sans-serif;
    }

    /* Tema Sol */
    body.theme-sun {
      --bg-primary: #1a0800;
      --bg-secondary: #2d1200;
      --accent: #ffe566;
      --accent2: #ff9d00;
      --text: #fff8e1;
      --text-muted: #ffcc80;
      --card-bg: rgba(45, 25, 5, 0.88);
      --card-border: rgba(255, 200, 0, 0.3);
      --glow: rgba(255, 230, 80, 0.5);
      --shine: rgba(255, 230, 80, 0.15);
    }

    /* Tema Nublado */
    body.theme-cloudy {
      --bg-primary: #1c2535;
      --bg-secondary: #2d3a4e;
      --accent: #9fb8d8;
      --accent2: #6b85a0;
      --text: #dde8f5;
      --text-muted: #a0b4c8;
      --card-bg: rgba(30, 45, 66, 0.88);
      --card-border: rgba(155, 190, 220, 0.25);
      --glow: rgba(155, 190, 220, 0.4);
      --shine: rgba(155, 190, 220, 0.15);
    }

    body {
      font-family: var(--font-body);
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      transition: var(--t);
    }

    /* ========================================================================
       CANVAS DE PART√çCULAS
       ======================================================================== */
    #fx {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    /* ========================================================================
       BARRA DE PROGRESSO DO TEMA
       ======================================================================== */
    .theme-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      z-index: 1000;
    }

    .theme-bar-progress {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      width: 0%;
      animation: progress 8s linear infinite;
      transition: background 0.5s ease;
    }

    @keyframes progress {
      from { width: 0%; }
      to { width: 100%; }
    }

    /* Flash de transi√ß√£o */
    .theme-flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--accent);
      opacity: 0;
      pointer-events: none;
      z-index: 999;
      transition: opacity 0.35s ease;
    }

    .theme-flash.active {
      opacity: 0.15;
    }

    /* ========================================================================
       HEADER
       ======================================================================== */
    header {
      position: relative;
      z-index: 10;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--card-border);
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    .logo {
      display: flex;
      flex-direction: column;
    }

    .logo-title {
      font-family: var(--font-display);
      font-size: 2rem;
      letter-spacing: 2px;
      color: var(--accent);
      line-height: 1;
    }

    .logo-subtitle {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--text-muted);
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    /* Toggle de temperatura */
    .temp-toggle {
      display: flex;
      border: 1px solid var(--card-border);
      border-radius: 8px;
      overflow: hidden;
    }

    .temp-toggle button {
      background: transparent;
      border: none;
      color: var(--text-muted);
      padding: 0.5rem 1rem;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      cursor: pointer;
      transition: var(--t);
    }

    .temp-toggle button.active {
      background: var(--accent);
      color: var(--bg-primary);
    }

    /* Bot√µes de tema */
    .theme-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .theme-btn {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      background: transparent;
      border: 1px solid var(--card-border);
      color: var(--text-muted);
      padding: 0.5rem 0.8rem;
      border-radius: 8px;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      cursor: pointer;
      transition: var(--t);
    }

    .theme-btn:hover {
      border-color: var(--accent);
      color: var(--text);
    }

    .theme-btn.active {
      background: var(--accent);
      color: var(--bg-primary);
      border-color: var(--accent);
    }

    .theme-btn .emoji {
      font-size: 1.1rem;
    }

    /* ========================================================================
       LAYOUT PRINCIPAL
       ======================================================================== */
    main {
      position: relative;
      z-index: 1;
      display: grid;
      grid-template-columns: 360px 1fr 320px;
      gap: 1.5rem;
      padding: 1.5rem 2rem;
      min-height: calc(100vh - 80px);
    }

    /* ========================================================================
       CARDS
       ======================================================================== */
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 1.25rem;
      box-shadow:
        0 4px 24px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 var(--shine);
      transition: var(--t);
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow:
        0 8px 32px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 var(--shine);
    }

    .card-title {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--text-muted);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* ========================================================================
       COLUNA ESQUERDA - LOCALIZA√á√ÉO
       ======================================================================== */
    .col-left {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    /* Card de localiza√ß√£o principal */
    .location-card {
      text-align: center;
    }

    .weather-icon {
      font-size: 4rem;
      margin: 0.5rem 0;
      filter: drop-shadow(0 4px 12px var(--glow));
      animation: bob 3.5s ease-in-out infinite;
    }

    @keyframes bob {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .main-temp {
      font-family: var(--font-display);
      font-size: 5.5rem;
      line-height: 1;
      color: var(--text);
      text-shadow: 0 4px 20px var(--glow);
    }

    .main-temp sup {
      font-size: 2rem;
      vertical-align: super;
      color: var(--accent);
    }

    .location-name {
      font-family: var(--font-body);
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--text);
      margin: 0.5rem 0 0.25rem;
    }

    .weather-desc {
      font-family: var(--font-mono);
      font-size: 0.85rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Grid de metadados */
    .meta-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      margin-top: 1.25rem;
      padding-top: 1.25rem;
      border-top: 1px solid var(--card-border);
    }

    .meta-item {
      text-align: center;
    }

    .meta-value {
      font-family: var(--font-display);
      font-size: 1.4rem;
      color: var(--accent);
    }

    .meta-label {
      font-family: var(--font-mono);
      font-size: 0.6rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Card de rel√≥gio */
    .clock-card {
      text-align: center;
    }

    .clock-time {
      font-family: var(--font-display);
      font-size: 3.5rem;
      color: var(--text);
      letter-spacing: 2px;
    }

    .clock-date {
      font-family: var(--font-mono);
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* B√∫ssola */
    .compass-container {
      display: flex;
      justify-content: center;
      margin-top: 1rem;
    }

    .compass {
      width: 80px;
      height: 80px;
      border: 2px solid var(--card-border);
      border-radius: 50%;
      position: relative;
      background: radial-gradient(circle, transparent 40%, var(--card-border) 100%);
    }

    .compass-point {
      position: absolute;
      font-family: var(--font-mono);
      font-size: 0.6rem;
      color: var(--text-muted);
    }

    .compass-point.n { top: 4px; left: 50%; transform: translateX(-50%); }
    .compass-point.s { bottom: 4px; left: 50%; transform: translateX(-50%); }
    .compass-point.e { right: 6px; top: 50%; transform: translateY(-50%); }
    .compass-point.w { left: 6px; top: 50%; transform: translateY(-50%); }

    .compass-needle {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 4px;
      height: 32px;
      background: linear-gradient(to bottom, var(--accent) 50%, var(--accent2) 50%);
      transform-origin: center bottom;
      transform: translate(-50%, -100%) rotate(0deg);
      border-radius: 2px;
      transition: transform 2s ease;
    }

    .compass-center {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 10px;
      height: 10px;
      background: var(--accent);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 10px var(--glow);
    }

    /* Card de alertas */
    .alerts-card .alert {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem;
      border-radius: 8px;
      margin-bottom: 0.75rem;
      font-size: 0.85rem;
    }

    .alert:last-child {
      margin-bottom: 0;
    }

    .alert.rain {
      background: rgba(239, 68, 68, 0.15);
      border-left: 3px solid #ef4444;
    }

    .alert.heat {
      background: rgba(245, 158, 11, 0.15);
      border-left: 3px solid #f59e0b;
    }

    .alert-icon {
      font-size: 1.2rem;
    }

    .alert-text {
      color: var(--text);
      line-height: 1.4;
    }

    /* ========================================================================
       COLUNA CENTRAL - MAPA
       ======================================================================== */
    .col-center {
      display: flex;
      flex-direction: column;
    }

    .map-card {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }

    .map-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, var(--glow) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      opacity: 0.18;
      pointer-events: none;
      transition: var(--t);
    }

    .map-header {
      text-align: center;
      margin-bottom: 1rem;
      position: relative;
      z-index: 2;
    }

    .map-title {
      font-family: var(--font-display);
      font-size: 1.8rem;
      color: var(--text);
      letter-spacing: 2px;
    }

    .map-subtitle {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .map-container {
      flex: 1;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .map-svg {
      width: 100%;
      max-width: 450px;
      height: auto;
    }

    .map-svg path {
      fill: none;
      stroke: var(--accent);
      stroke-width: 1.5;
      opacity: 0.6;
      transition: var(--t);
    }

    .map-svg .grid-line {
      stroke: var(--card-border);
      stroke-width: 0.5;
      opacity: 0.3;
    }

    .map-svg .special-line {
      stroke: var(--accent2);
      stroke-width: 1;
      stroke-dasharray: 5, 5;
      opacity: 0.4;
    }

    /* Pontos dos estados no mapa */
    .state-point {
      position: absolute;
      width: 14px;
      height: 14px;
      background: var(--accent);
      border: 2px solid var(--text);
      border-radius: 50%;
      cursor: pointer;
      transform: translate(-50%, -50%);
      transition: var(--t);
      z-index: 5;
    }

    .state-point::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 100%;
      background: var(--accent);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
      opacity: 0;
    }

    @keyframes ping {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
      100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; }
    }

    .state-point:hover {
      transform: translate(-50%, -50%) scale(1.4);
      box-shadow: 0 0 20px var(--glow);
    }

    .state-point.selected {
      background: var(--text);
      border-color: var(--accent);
      box-shadow: 0 0 20px var(--glow);
    }

    /* Tooltip do estado */
    .state-tooltip {
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 6px;
      padding: 0.4rem 0.6rem;
      white-space: nowrap;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 10;
    }

    .state-point:hover .state-tooltip {
      opacity: 1;
    }

    .state-tooltip-code {
      color: var(--accent);
      font-weight: 600;
    }

    .state-tooltip-temp {
      color: var(--text);
      margin-left: 0.5rem;
    }

    /* ========================================================================
       COLUNA DIREITA - PREVIS√ÉO E ESTADOS
       ======================================================================== */
    .col-right {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    /* Previs√£o 5 dias */
    .forecast-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.5rem;
    }

    .forecast-day {
      text-align: center;
      padding: 0.75rem 0.25rem;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--t);
      border: 1px solid transparent;
    }

    .forecast-day:hover,
    .forecast-day.selected {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--card-border);
    }

    .forecast-day-name {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .forecast-day.selected .forecast-day-name {
      color: var(--accent);
    }

    .forecast-icon {
      font-size: 1.5rem;
      margin: 0.4rem 0;
    }

    .forecast-temps {
      font-family: var(--font-display);
    }

    .forecast-max {
      font-size: 1.1rem;
      color: var(--text);
    }

    .forecast-min {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .forecast-rain {
      font-family: var(--font-mono);
      font-size: 0.6rem;
      color: var(--accent);
      margin-top: 0.25rem;
    }

    /* Card de estados */
    .states-card {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .states-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .states-tab {
      flex: 1;
      background: transparent;
      border: 1px solid var(--card-border);
      color: var(--text-muted);
      padding: 0.5rem;
      border-radius: 8px;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: var(--t);
    }

    .states-tab:hover {
      border-color: var(--accent);
    }

    .states-tab.active {
      background: var(--accent);
      color: var(--bg-primary);
      border-color: var(--accent);
    }

    .states-content {
      flex: 1;
      overflow-y: auto;
      min-height: 0;
    }

    .states-content::-webkit-scrollbar {
      width: 4px;
    }

    .states-content::-webkit-scrollbar-track {
      background: var(--card-border);
      border-radius: 2px;
    }

    .states-content::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 2px;
    }

    /* Grid de todos os estados */
    .states-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    .state-item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.5rem;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--t);
      border: 1px solid transparent;
    }

    .state-item:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--card-border);
    }

    .state-item.selected {
      background: rgba(255, 255, 255, 0.08);
      border-color: var(--accent);
    }

    .state-item-icon {
      font-size: 1rem;
    }

    .state-item-code {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--text-muted);
      font-weight: 600;
    }

    .state-item-temp {
      font-family: var(--font-display);
      font-size: 1rem;
      color: var(--text);
      margin-left: auto;
    }

    /* Painel de detalhe do estado */
    .state-detail {
      display: none;
    }

    .state-detail.active {
      display: block;
    }

    .state-detail-header {
      text-align: center;
      margin-bottom: 1.25rem;
    }

    .state-detail-icon {
      font-size: 3rem;
      filter: drop-shadow(0 4px 12px var(--glow));
    }

    .state-detail-name {
      font-family: var(--font-display);
      font-size: 1.8rem;
      color: var(--text);
      margin-top: 0.5rem;
    }

    .state-detail-desc {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .state-detail-temp {
      font-family: var(--font-display);
      font-size: 3.5rem;
      color: var(--accent);
      margin: 0.5rem 0;
    }

    .state-detail-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-top: 1rem;
    }

    .detail-item {
      text-align: center;
    }

    .detail-item-label {
      font-family: var(--font-mono);
      font-size: 0.6rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.4rem;
    }

    .detail-item-value {
      font-family: var(--font-display);
      font-size: 1.4rem;
      color: var(--text);
    }

    /* Barra de umidade */
    .humidity-bar {
      height: 8px;
      background: var(--card-border);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 0.5rem;
    }

    .humidity-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent2), var(--accent));
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    /* Escala UV */
    .uv-scale {
      display: flex;
      gap: 3px;
      margin-top: 0.5rem;
    }

    .uv-block {
      flex: 1;
      height: 8px;
      background: var(--card-border);
      border-radius: 2px;
      transition: var(--t);
    }

    .uv-block.active {
      background: var(--accent);
    }

    /* Card de umidade */
    .humidity-card {
      text-align: center;
    }

    .humidity-value {
      font-family: var(--font-display);
      font-size: 3rem;
      color: var(--accent);
    }

    .humidity-desc {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.5rem;
    }

    .humidity-bar-large {
      height: 12px;
      background: var(--card-border);
      border-radius: 6px;
      overflow: hidden;
      margin-top: 1rem;
    }

    .humidity-fill-large {
      height: 100%;
      background: linear-gradient(90deg, var(--accent2), var(--accent));
      border-radius: 6px;
      transition: width 0.5s ease;
    }

    /* ========================================================================
       RESPONSIVO
       ======================================================================== */
    @media (max-width: 1200px) {
      main {
        grid-template-columns: 1fr 1fr;
      }

      .col-center {
        grid-column: span 2;
        order: -1;
      }

      .map-card {
        min-height: 400px;
      }
    }

    @media (max-width: 768px) {
      main {
        grid-template-columns: 1fr;
        padding: 1rem;
      }

      .col-center {
        grid-column: span 1;
      }

      header {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }

      .header-controls {
        flex-wrap: wrap;
        justify-content: center;
      }

      .theme-buttons {
        display: none;
      }

      .main-temp {
        font-size: 4rem;
      }

      .meta-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .forecast-grid {
        grid-template-columns: repeat(5, 1fr);
        gap: 0.25rem;
      }

      .forecast-day {
        padding: 0.5rem 0.15rem;
      }

      .states-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* ========================================================================
       UTILIT√ÅRIOS
       ======================================================================== */
    .hidden {
      display: none !important;
    }

    .loading {
      opacity: 0.5;
    }
  </style>
</head>
<body class="theme-rain">
  <!-- Canvas de part√≠culas -->
  <canvas id="fx"></canvas>

  <!-- Barra de progresso do tema -->
  <div class="theme-bar">
    <div class="theme-bar-progress" id="themeProgress"></div>
  </div>

  <!-- Flash de transi√ß√£o -->
  <div class="theme-flash" id="themeFlash"></div>

  <!-- Header -->
  <header>
    <div class="logo">
      <span class="logo-title">METEOGOV BRASIL</span>
      <span class="logo-subtitle">Intelig√™ncia Clim√°tica ¬∑ metbrasil.com.br</span>
    </div>
    <div class="header-controls">
      <div class="temp-toggle">
        <button id="btnCelsius" class="active" onclick="setUnit('C')">¬∞C</button>
        <button id="btnFahrenheit" onclick="setUnit('F')">¬∞F</button>
      </div>
      <div class="theme-buttons">
        <button class="theme-btn active" id="btnRain" onclick="setTheme('rain', true)">
          <span class="emoji">‚õàÔ∏è</span>
          <span>Chuva</span>
        </button>
        <button class="theme-btn" id="btnSun" onclick="setTheme('sun', true)">
          <span class="emoji">‚òÄÔ∏è</span>
          <span>Sol</span>
        </button>
        <button class="theme-btn" id="btnCloudy" onclick="setTheme('cloudy', true)">
          <span class="emoji">‚õÖ</span>
          <span>Nublado</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Layout Principal -->
  <main>
    <!-- Coluna Esquerda -->
    <div class="col-left">
      <!-- Card de Localiza√ß√£o -->
      <div class="card location-card">
        <div class="card-title">üìç Localiza√ß√£o Atual via IP</div>
        <div class="weather-icon" id="mainIcon">‚õàÔ∏è</div>
        <div class="main-temp"><span id="mainTemp">--</span><sup id="mainUnit">¬∞C</sup></div>
        <div class="location-name" id="locationName">Carregando...</div>
        <div class="weather-desc" id="weatherDesc">--</div>
        <div class="meta-grid">
          <div class="meta-item">
            <div class="meta-value" id="feelsLike">--¬∞</div>
            <div class="meta-label">Sensa√ß√£o</div>
          </div>
          <div class="meta-item">
            <div class="meta-value" id="humidity">--%</div>
            <div class="meta-label">Umidade</div>
          </div>
          <div class="meta-item">
            <div class="meta-value" id="wind">-- km/h</div>
            <div class="meta-label">Vento</div>
          </div>
          <div class="meta-item">
            <div class="meta-value" id="pressure">-- hPa</div>
            <div class="meta-label">Press√£o</div>
          </div>
          <div class="meta-item">
            <div class="meta-value" id="visibility">-- km</div>
            <div class="meta-label">Visibilidade</div>
          </div>
          <div class="meta-item">
            <div class="meta-value" id="clouds">--%</div>
            <div class="meta-label">Nuvens</div>
          </div>
        </div>
      </div>

      <!-- Card de Rel√≥gio -->
      <div class="card clock-card">
        <div class="card-title">üïê Hor√°rio de Bras√≠lia</div>
        <div class="clock-time" id="clockTime">--:--:--</div>
        <div class="clock-date" id="clockDate">--</div>
        <div class="compass-container">
          <div class="compass">
            <span class="compass-point n">N</span>
            <span class="compass-point s">S</span>
            <span class="compass-point e">L</span>
            <span class="compass-point w">O</span>
            <div class="compass-needle" id="compassNeedle"></div>
            <div class="compass-center"></div>
          </div>
        </div>
      </div>

      <!-- Card de Alertas -->
      <div class="card alerts-card">
        <div class="card-title">‚ö†Ô∏è Alertas Meteorol√≥gicos</div>
        <div class="alert rain">
          <span class="alert-icon">üåßÔ∏è</span>
          <span class="alert-text">Possibilidade de chuvas intensas nas regi√µes Sul e Sudeste nas pr√≥ximas 24h.</span>
        </div>
        <div class="alert heat">
          <span class="alert-icon">üå°Ô∏è</span>
          <span class="alert-text">Onda de calor prevista para o Centro-Oeste com temperaturas acima de 38¬∞C.</span>
        </div>
      </div>
    </div>

    <!-- Coluna Central - Mapa -->
    <div class="col-center">
      <div class="card map-card">
        <div class="map-glow"></div>
        <div class="map-header">
          <div class="map-title">BRASIL</div>
          <div class="map-subtitle">Clique em um estado para ver detalhes</div>
        </div>
        <div class="map-container">
          <svg class="map-svg" viewBox="0 0 500 560" preserveAspectRatio="xMidYMid meet">
            <!-- Linhas de grade -->
            <line class="grid-line" x1="0" y1="140" x2="500" y2="140"/>
            <line class="grid-line" x1="0" y1="280" x2="500" y2="280"/>
            <line class="grid-line" x1="0" y1="420" x2="500" y2="420"/>
            <line class="grid-line" x1="125" y1="0" x2="125" y2="560"/>
            <line class="grid-line" x1="250" y1="0" x2="250" y2="560"/>
            <line class="grid-line" x1="375" y1="0" x2="375" y2="560"/>

            <!-- Linha do Equador -->
            <line class="special-line" x1="0" y1="95" x2="500" y2="95"/>
            <text x="10" y="90" fill="var(--text-muted)" font-size="8" font-family="var(--font-mono)">Equador</text>

            <!-- Tr√≥pico de Capric√≥rnio -->
            <line class="special-line" x1="0" y1="400" x2="500" y2="400"/>
            <text x="10" y="395" fill="var(--text-muted)" font-size="8" font-family="var(--font-mono)">Tr√≥pico de Capric√≥rnio</text>

            <!-- Contorno do Brasil (simplificado) -->
            <path d="M320,30 Q380,35 400,60 Q430,90 440,130 Q455,170 460,210
                     Q465,260 450,300 Q440,340 420,380 Q400,420 370,450
                     Q340,480 300,500 Q260,515 220,510 Q180,505 150,480
                     Q120,455 100,420 Q80,380 70,340 Q60,300 65,260
                     Q70,220 90,180 Q110,140 140,110 Q170,80 210,60
                     Q250,40 290,32 Q310,30 320,30 Z"/>
          </svg>

          <!-- Pontos dos estados ser√£o inseridos via JS -->
          <div id="statePoints"></div>
        </div>
      </div>
    </div>

    <!-- Coluna Direita -->
    <div class="col-right">
      <!-- Previs√£o 5 dias -->
      <div class="card">
        <div class="card-title">üìÖ Previs√£o 5 Dias</div>
        <div class="forecast-grid" id="forecastGrid">
          <!-- Preenchido via JS -->
        </div>
      </div>

      <!-- Estados -->
      <div class="card states-card">
        <div class="card-title">üó∫Ô∏è Estados Brasileiros</div>
        <div class="states-tabs">
          <button class="states-tab active" id="tabAll" onclick="showTab('all')">Todos</button>
          <button class="states-tab" id="tabDetail" onclick="showTab('detail')">Detalhe</button>
        </div>
        <div class="states-content">
          <div class="states-grid" id="statesAll">
            <!-- Preenchido via JS -->
          </div>
          <div class="state-detail" id="statesDetail">
            <div class="state-detail-header">
              <div class="state-detail-icon" id="detailIcon">--</div>
              <div class="state-detail-name" id="detailName">Selecione um estado</div>
              <div class="state-detail-desc" id="detailDesc">--</div>
              <div class="state-detail-temp" id="detailTemp">--¬∞</div>
            </div>
            <div class="state-detail-grid">
              <div class="detail-item">
                <div class="detail-item-label">Umidade</div>
                <div class="detail-item-value" id="detailHumidity">--%</div>
                <div class="humidity-bar">
                  <div class="humidity-fill" id="detailHumidityBar" style="width: 0%"></div>
                </div>
              </div>
              <div class="detail-item">
                <div class="detail-item-label">√çndice UV</div>
                <div class="detail-item-value" id="detailUV">--</div>
                <div class="uv-scale" id="detailUVScale">
                  <div class="uv-block"></div>
                  <div class="uv-block"></div>
                  <div class="uv-block"></div>
                  <div class="uv-block"></div>
                  <div class="uv-block"></div>
                  <div class="uv-block"></div>
                  <div class="uv-block"></div>
                  <div class="uv-block"></div>
                  <div class="uv-block"></div>
                  <div class="uv-block"></div>
                </div>
              </div>
              <div class="detail-item">
                <div class="detail-item-label">Vento</div>
                <div class="detail-item-value" id="detailWind">-- km/h</div>
              </div>
              <div class="detail-item">
                <div class="detail-item-label">Prob. Chuva</div>
                <div class="detail-item-value" id="detailRain">--%</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Umidade -->
      <div class="card humidity-card">
        <div class="card-title">üíß Umidade do Ar</div>
        <div class="humidity-value"><span id="humidityMain">--</span>%</div>
        <div class="humidity-desc" id="humidityDesc">--</div>
        <div class="humidity-bar-large">
          <div class="humidity-fill-large" id="humidityBar" style="width: 0%"></div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // =========================================================================
    // DADOS DOS ESTADOS BRASILEIROS
    // =========================================================================
    const STATES = [
      { code: 'AC', name: 'Acre', lat: -9.97, lon: -67.81, x: 85, y: 215 },
      { code: 'AL', name: 'Alagoas', lat: -9.66, lon: -35.74, x: 420, y: 205 },
      { code: 'AP', name: 'Amap√°', lat: 1.41, lon: -51.77, x: 310, y: 65 },
      { code: 'AM', name: 'Amazonas', lat: -3.47, lon: -65.10, x: 145, y: 140 },
      { code: 'BA', name: 'Bahia', lat: -12.97, lon: -38.50, x: 385, y: 270 },
      { code: 'CE', name: 'Cear√°', lat: -3.79, lon: -38.50, x: 400, y: 125 },
      { code: 'DF', name: 'Distrito Federal', lat: -15.83, lon: -47.86, x: 320, y: 320 },
      { code: 'ES', name: 'Esp√≠rito Santo', lat: -19.19, lon: -40.34, x: 400, y: 370 },
      { code: 'GO', name: 'Goi√°s', lat: -16.64, lon: -49.31, x: 295, y: 340 },
      { code: 'MA', name: 'Maranh√£o', lat: -2.63, lon: -44.30, x: 355, y: 115 },
      { code: 'MT', name: 'Mato Grosso', lat: -12.64, lon: -55.42, x: 215, y: 270 },
      { code: 'MS', name: 'Mato Grosso do Sul', lat: -20.51, lon: -54.54, x: 230, y: 385 },
      { code: 'MG', name: 'Minas Gerais', lat: -18.10, lon: -44.38, x: 355, y: 365 },
      { code: 'PA', name: 'Par√°', lat: -5.53, lon: -52.29, x: 270, y: 135 },
      { code: 'PB', name: 'Para√≠ba', lat: -7.06, lon: -35.55, x: 425, y: 170 },
      { code: 'PR', name: 'Paran√°', lat: -25.25, lon: -52.02, x: 275, y: 445 },
      { code: 'PE', name: 'Pernambuco', lat: -8.28, lon: -35.07, x: 415, y: 185 },
      { code: 'PI', name: 'Piau√≠', lat: -8.28, lon: -43.68, x: 360, y: 175 },
      { code: 'RJ', name: 'Rio de Janeiro', lat: -22.84, lon: -43.15, x: 380, y: 410 },
      { code: 'RN', name: 'Rio Grande do Norte', lat: -5.22, lon: -36.52, x: 420, y: 145 },
      { code: 'RS', name: 'Rio Grande do Sul', lat: -30.01, lon: -51.22, x: 270, y: 505 },
      { code: 'RO', name: 'Rond√¥nia', lat: -11.22, lon: -62.80, x: 130, y: 245 },
      { code: 'RR', name: 'Roraima', lat: 1.89, lon: -61.22, x: 165, y: 60 },
      { code: 'SC', name: 'Santa Catarina', lat: -27.33, lon: -49.44, x: 295, y: 475 },
      { code: 'SP', name: 'S√£o Paulo', lat: -23.55, lon: -46.64, x: 320, y: 415 },
      { code: 'SE', name: 'Sergipe', lat: -10.90, lon: -37.07, x: 410, y: 225 },
      { code: 'TO', name: 'Tocantins', lat: -10.25, lon: -48.25, x: 310, y: 225 }
    ];

    // =========================================================================
    // VARI√ÅVEIS GLOBAIS
    // =========================================================================
    let curTheme = 'rain';
    let curUnit = 'C';
    let themeTimer = null;
    let manualTimer = null;
    let selectedState = null;
    let userLocation = { lat: -23.55, lon: -46.64, city: 'S√£o Paulo', state: 'SP' };
    let cache = {};
    let particles = [];
    let canvas, ctx;

    // =========================================================================
    // MAPEAMENTO WMO
    // =========================================================================
    function wmoIcon(code) {
      if (code === 0) return '‚òÄÔ∏è';
      if (code <= 2) return '‚õÖ';
      if (code === 3) return '‚òÅÔ∏è';
      if (code >= 45 && code <= 49) return 'üå´Ô∏è';
      if (code >= 51 && code <= 59) return 'üå¶Ô∏è';
      if (code >= 61 && code <= 69) return '‚ùÑÔ∏è';
      if (code >= 71 && code <= 82) return 'üåßÔ∏è';
      if (code >= 85 && code <= 94) return '‚õàÔ∏è';
      return '‚õàÔ∏è';
    }

    function wmoDesc(code) {
      if (code === 0) return 'C√©u limpo';
      if (code <= 2) return 'Parcialmente nublado';
      if (code === 3) return 'Nublado';
      if (code >= 45 && code <= 49) return 'Nevoeiro';
      if (code >= 51 && code <= 59) return 'Garoa';
      if (code >= 61 && code <= 69) return 'Neve';
      if (code >= 71 && code <= 82) return 'Chuva';
      if (code >= 85) return 'Tempestade';
      return 'Vari√°vel';
    }

    // =========================================================================
    // CONVERS√ÉO DE TEMPERATURA
    // =========================================================================
    function toUnit(temp) {
      if (curUnit === 'F') return Math.round((temp * 9/5) + 32);
      return Math.round(temp);
    }

    function setUnit(unit) {
      curUnit = unit;
      document.getElementById('btnCelsius').classList.toggle('active', unit === 'C');
      document.getElementById('btnFahrenheit').classList.toggle('active', unit === 'F');
      document.getElementById('mainUnit').textContent = '¬∞' + unit;
      updateAllTemps();
    }

    function updateAllTemps() {
      // Atualizar temperatura principal
      const mainTempEl = document.getElementById('mainTemp');
      if (mainTempEl.dataset.temp) {
        mainTempEl.textContent = toUnit(parseFloat(mainTempEl.dataset.temp));
      }

      // Atualizar sensa√ß√£o t√©rmica
      const feelsEl = document.getElementById('feelsLike');
      if (feelsEl.dataset.temp) {
        feelsEl.textContent = toUnit(parseFloat(feelsEl.dataset.temp)) + '¬∞';
      }

      // Atualizar grid de estados
      document.querySelectorAll('.state-item-temp').forEach(el => {
        if (el.dataset.temp) {
          el.textContent = toUnit(parseFloat(el.dataset.temp)) + '¬∞';
        }
      });

      // Atualizar tooltips
      document.querySelectorAll('.state-tooltip-temp').forEach(el => {
        if (el.dataset.temp) {
          el.textContent = toUnit(parseFloat(el.dataset.temp)) + '¬∞';
        }
      });

      // Atualizar detalhe
      const detailTempEl = document.getElementById('detailTemp');
      if (detailTempEl.dataset.temp) {
        detailTempEl.textContent = toUnit(parseFloat(detailTempEl.dataset.temp)) + '¬∞';
      }

      // Atualizar previs√£o
      document.querySelectorAll('.forecast-max').forEach(el => {
        if (el.dataset.temp) {
          el.textContent = toUnit(parseFloat(el.dataset.temp)) + '¬∞';
        }
      });
      document.querySelectorAll('.forecast-min').forEach(el => {
        if (el.dataset.temp) {
          el.textContent = toUnit(parseFloat(el.dataset.temp)) + '¬∞';
        }
      });
    }

    // =========================================================================
    // SISTEMA DE TEMAS
    // =========================================================================
    function setTheme(theme, manual = false) {
      // Flash de transi√ß√£o
      const flash = document.getElementById('themeFlash');
      flash.classList.add('active');
      setTimeout(() => flash.classList.remove('active'), 350);

      // Atualizar classe do body
      document.body.className = 'theme-' + theme;
      curTheme = theme;

      // Atualizar bot√µes
      document.getElementById('btnRain').classList.toggle('active', theme === 'rain');
      document.getElementById('btnSun').classList.toggle('active', theme === 'sun');
      document.getElementById('btnCloudy').classList.toggle('active', theme === 'cloudy');

      // Reiniciar part√≠culas
      initParticles();

      // Reiniciar barra de progresso
      const progress = document.getElementById('themeProgress');
      progress.style.animation = 'none';
      progress.offsetHeight; // Force reflow
      progress.style.animation = 'progress 8s linear infinite';

      // Se manual, pausar auto e retomar ap√≥s 24s
      if (manual) {
        clearInterval(themeTimer);
        clearTimeout(manualTimer);
        manualTimer = setTimeout(startAutoTheme, 24000);
      }
    }

    function nextTheme() {
      const themes = ['rain', 'sun', 'cloudy'];
      const idx = (themes.indexOf(curTheme) + 1) % 3;
      setTheme(themes[idx]);
    }

    function startAutoTheme() {
      clearInterval(themeTimer);
      themeTimer = setInterval(nextTheme, 8000);
    }

    // =========================================================================
    // CANVAS DE PART√çCULAS
    // =========================================================================
    class Particle {
      constructor() {
        this.theme = curTheme;
        this.init();
      }

      init() {
        this.theme = curTheme;
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;

        if (curTheme === 'rain') {
          this.vx = -(1.5 + Math.random());
          this.vy = 10 + Math.random() * 8;
          this.length = 10 + Math.random() * 14;
          this.width = 1 + Math.random() * 1.5;
          this.alpha = 0.15 + Math.random() * 0.35;
        } else if (curTheme === 'sun') {
          this.vx = (Math.random() - 0.5) * 0.5;
          this.vy = -(0.25 + Math.random() * 0.4);
          this.radius = 1.5 + Math.random() * 3;
          this.alpha = 0.12 + Math.random() * 0.25;
        } else {
          this.vx = 0.25 + Math.random() * 0.4;
          this.vy = (Math.random() - 0.5) * 0.2;
          this.radiusX = 30 + Math.random() * 70;
          this.radiusY = this.radiusX / 2.2;
          this.alpha = 0.025 + Math.random() * 0.04;
        }
      }

      update() {
        if (this.theme !== curTheme) this.init();

        this.x += this.vx;
        this.y += this.vy;

        if (curTheme === 'rain') {
          if (this.y > canvas.height) {
            this.y = -20;
            this.x = Math.random() * canvas.width;
          }
          if (this.x < 0) this.x = canvas.width;
        } else if (curTheme === 'sun') {
          if (this.y < -10) {
            this.y = canvas.height + 10;
            this.x = Math.random() * canvas.width;
          }
        } else {
          if (this.x > canvas.width + this.radiusX) {
            this.x = -this.radiusX;
            this.y = Math.random() * canvas.height;
          }
        }
      }

      draw() {
        ctx.beginPath();
        if (curTheme === 'rain') {
          ctx.strokeStyle = `rgba(79, 195, 247, ${this.alpha})`;
          ctx.lineWidth = this.width;
          ctx.moveTo(this.x, this.y);
          ctx.lineTo(this.x + this.vx * 2, this.y + this.length);
          ctx.stroke();
        } else if (curTheme === 'sun') {
          ctx.fillStyle = `rgba(255, 235, 100, ${this.alpha})`;
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
          ctx.fill();
        } else {
          ctx.fillStyle = `rgba(155, 185, 215, ${this.alpha})`;
          ctx.ellipse(this.x, this.y, this.radiusX, this.radiusY, 0, 0, Math.PI * 2);
          ctx.fill();
        }
      }
    }

    function initParticles() {
      const count = curTheme === 'rain' ? 130 : curTheme === 'sun' ? 55 : 10;
      particles = [];
      for (let i = 0; i < count; i++) {
        particles.push(new Particle());
      }
    }

    function animateParticles() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p => {
        p.update();
        p.draw();
      });
      requestAnimationFrame(animateParticles);
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    // =========================================================================
    // REL√ìGIO
    // =========================================================================
    function updateClock() {
      const now = new Date();
      const options = { timeZone: 'America/Sao_Paulo' };

      const time = now.toLocaleTimeString('pt-BR', { ...options, hour12: false });
      document.getElementById('clockTime').textContent = time;

      const dateOpts = { ...options, weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' };
      const date = now.toLocaleDateString('pt-BR', dateOpts);
      document.getElementById('clockDate').textContent = date;
    }

    // =========================================================================
    // BUSCA DE DADOS
    // =========================================================================
    async function getLocation() {
      try {
        const res = await fetch('https://ipapi.co/json/');
        const data = await res.json();
        userLocation = {
          lat: data.latitude || -23.55,
          lon: data.longitude || -46.64,
          city: data.city || 'S√£o Paulo',
          state: data.region_code || 'SP'
        };
      } catch (e) {
        console.log('Fallback para S√£o Paulo');
      }
      loadMainWeather();
    }

    async function fetchWeather(lat, lon) {
      const key = lat.toFixed(1) + ',' + lon.toFixed(1);
      if (cache[key]) return cache[key];

      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,wind_direction_10m,surface_pressure,visibility,cloud_cover&daily=temperature_2m_max,temperature_2m_min,weather_code,precipitation_probability_max&timezone=America/Sao_Paulo&forecast_days=5`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        cache[key] = data;
        return data;
      } catch (e) {
        return null;
      }
    }

    async function loadMainWeather() {
      const data = await fetchWeather(userLocation.lat, userLocation.lon);
      if (!data || !data.current) return;

      const c = data.current;

      // √çcone e temperatura
      document.getElementById('mainIcon').textContent = wmoIcon(c.weather_code);
      const mainTempEl = document.getElementById('mainTemp');
      mainTempEl.dataset.temp = c.temperature_2m;
      mainTempEl.textContent = toUnit(c.temperature_2m);

      // Localiza√ß√£o
      document.getElementById('locationName').textContent = `${userLocation.city}, ${userLocation.state}`;
      document.getElementById('weatherDesc').textContent = wmoDesc(c.weather_code);

      // Metadados
      const feelsEl = document.getElementById('feelsLike');
      feelsEl.dataset.temp = c.apparent_temperature;
      feelsEl.textContent = toUnit(c.apparent_temperature) + '¬∞';

      document.getElementById('humidity').textContent = c.relative_humidity_2m + '%';
      document.getElementById('wind').textContent = Math.round(c.wind_speed_10m) + ' km/h';
      document.getElementById('pressure').textContent = Math.round(c.surface_pressure) + ' hPa';
      document.getElementById('visibility').textContent = (c.visibility / 1000).toFixed(1) + ' km';
      document.getElementById('clouds').textContent = c.cloud_cover + '%';

      // B√∫ssola
      document.getElementById('compassNeedle').style.transform =
        `translate(-50%, -100%) rotate(${c.wind_direction_10m}deg)`;

      // Umidade principal
      document.getElementById('humidityMain').textContent = c.relative_humidity_2m;
      document.getElementById('humidityBar').style.width = c.relative_humidity_2m + '%';

      let humidityDesc = 'Confort√°vel';
      if (c.relative_humidity_2m < 30) humidityDesc = 'Baixa ‚Äî hidrate-se!';
      else if (c.relative_humidity_2m > 60) humidityDesc = 'Alta ‚Äî tempo abafado';
      document.getElementById('humidityDesc').textContent = humidityDesc;

      // Previs√£o 5 dias
      renderForecast(data.daily);
    }

    function renderForecast(daily) {
      const grid = document.getElementById('forecastGrid');
      grid.innerHTML = '';

      const days = ['DOM', 'SEG', 'TER', 'QUA', 'QUI', 'SEX', 'S√ÅB'];
      const today = new Date().getDay();

      for (let i = 0; i < 5; i++) {
        const dayName = i === 0 ? 'HOJE' : days[(today + i) % 7];
        const icon = wmoIcon(daily.weather_code[i]);
        const max = daily.temperature_2m_max[i];
        const min = daily.temperature_2m_min[i];
        const rain = daily.precipitation_probability_max[i] || 0;

        const div = document.createElement('div');
        div.className = 'forecast-day' + (i === 0 ? ' selected' : '');
        div.innerHTML = `
          <div class="forecast-day-name">${dayName}</div>
          <div class="forecast-icon">${icon}</div>
          <div class="forecast-temps">
            <span class="forecast-max" data-temp="${max}">${toUnit(max)}¬∞</span>
            <span class="forecast-min" data-temp="${min}">${toUnit(min)}¬∞</span>
          </div>
          <div class="forecast-rain">üíß${rain}%</div>
        `;
        div.onclick = () => {
          document.querySelectorAll('.forecast-day').forEach(d => d.classList.remove('selected'));
          div.classList.add('selected');
        };
        grid.appendChild(div);
      }
    }

    // =========================================================================
    // ESTADOS
    // =========================================================================
    async function buildStates() {
      const statesGrid = document.getElementById('statesAll');
      const pointsContainer = document.getElementById('statePoints');
      statesGrid.innerHTML = '';
      pointsContainer.innerHTML = '';

      // Buscar dados de todos os estados em paralelo
      const promises = STATES.map(async s => {
        const data = await fetchWeather(s.lat, s.lon);
        if (data && data.current) {
          s._t = data.current.temperature_2m;
          s._h = data.current.relative_humidity_2m;
          s._w = data.current.wind_speed_10m;
          s._c = data.current.weather_code;
          s._wd = data.current.wind_direction_10m;
          s._daily = data.daily;
          s._prec = data.daily?.precipitation_probability_max?.[0] || 0;
        }
        return s;
      });

      const states = await Promise.all(promises);

      states.forEach(s => {
        // Item no grid
        const item = document.createElement('div');
        item.className = 'state-item';
        item.dataset.code = s.code;
        item.innerHTML = `
          <span class="state-item-icon">${wmoIcon(s._c || 0)}</span>
          <span class="state-item-code">${s.code}</span>
          <span class="state-item-temp" data-temp="${s._t || 0}">${s._t ? toUnit(s._t) + '¬∞' : '?'}</span>
        `;
        item.onclick = () => selectState(s);
        statesGrid.appendChild(item);

        // Ponto no mapa
        const point = document.createElement('div');
        point.className = 'state-point';
        point.dataset.code = s.code;
        point.style.left = (s.x / 500 * 100) + '%';
        point.style.top = (s.y / 560 * 100) + '%';
        point.innerHTML = `
          <div class="state-tooltip">
            <span class="state-tooltip-code">${s.code}</span>
            <span class="state-tooltip-temp" data-temp="${s._t || 0}">${s._t ? toUnit(s._t) + '¬∞' : '?'}</span>
          </div>
        `;
        point.onclick = () => selectState(s);
        pointsContainer.appendChild(point);
      });
    }

    function selectState(s) {
      selectedState = s;

      // Marcar selecionado no grid
      document.querySelectorAll('.state-item').forEach(el => {
        el.classList.toggle('selected', el.dataset.code === s.code);
      });

      // Marcar selecionado no mapa
      document.querySelectorAll('.state-point').forEach(el => {
        el.classList.toggle('selected', el.dataset.code === s.code);
      });

      // Preencher detalhes
      document.getElementById('detailIcon').textContent = wmoIcon(s._c || 0);
      document.getElementById('detailName').textContent = s.name;
      document.getElementById('detailDesc').textContent = wmoDesc(s._c || 0);

      const detailTempEl = document.getElementById('detailTemp');
      detailTempEl.dataset.temp = s._t || 0;
      detailTempEl.textContent = (s._t ? toUnit(s._t) : '--') + '¬∞';

      document.getElementById('detailHumidity').textContent = (s._h || '--') + '%';
      document.getElementById('detailHumidityBar').style.width = (s._h || 0) + '%';

      const uv = Math.floor(Math.random() * 11); // Demonstrativo
      document.getElementById('detailUV').textContent = uv;
      document.querySelectorAll('#detailUVScale .uv-block').forEach((b, i) => {
        b.classList.toggle('active', i < uv);
      });

      document.getElementById('detailWind').textContent = Math.round(s._w || 0) + ' km/h';
      document.getElementById('detailRain').textContent = (s._prec || 0) + '%';

      // Atualizar previs√£o para o estado
      if (s._daily) {
        renderForecast(s._daily);
      }

      // Mudar para aba de detalhes
      showTab('detail');
    }

    function showTab(tab) {
      document.getElementById('tabAll').classList.toggle('active', tab === 'all');
      document.getElementById('tabDetail').classList.toggle('active', tab === 'detail');
      document.getElementById('statesAll').classList.toggle('hidden', tab !== 'all');
      document.getElementById('statesDetail').classList.toggle('active', tab === 'detail');
    }

    // =========================================================================
    // INICIALIZA√á√ÉO
    // =========================================================================
    document.addEventListener('DOMContentLoaded', () => {
      // Canvas
      canvas = document.getElementById('fx');
      ctx = canvas.getContext('2d');
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
      initParticles();
      animateParticles();

      // Tema
      setTheme('rain');
      startAutoTheme();

      // Rel√≥gio
      updateClock();
      setInterval(updateClock, 1000);

      // Dados
      getLocation();
      buildStates();
    });
  </script>
</body>
</html>
